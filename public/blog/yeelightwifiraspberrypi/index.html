<!DOCTYPE html>
<html lang="en-US">

<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">
<meta name="author" content="Shyam Valsan">
<meta name="description" content="Yeelight (now owned by Xiaomi) is a company which makes smart bulbs which can be controlled over WiFi or BLE (Bluetooth Low Energy). I got my hands on one of their WiFi smart bulbs as part of some hackathon goodies from work. They have a snappy android app which let&rsquo;s you change colors, brightness and allow the light to flash/flow according to the music you&rsquo;re playing. All very nice and dandy - but in the spirit of tinkerers and DIYers everywhere, that wasn&rsquo;t what I was here for.">

<meta property="og:title" content="Let there be light!" />
<meta property="og:description" content="Yeelight (now owned by Xiaomi) is a company which makes smart bulbs which can be controlled over WiFi or BLE (Bluetooth Low Energy). I got my hands on one of their WiFi smart bulbs as part of some hackathon goodies from work. They have a snappy android app which let&rsquo;s you change colors, brightness and allow the light to flash/flow according to the music you&rsquo;re playing. All very nice and dandy - but in the spirit of tinkerers and DIYers everywhere, that wasn&rsquo;t what I was here for." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/https:/shyamvalsan.com/blog/yeelightwifiraspberrypi/" />



<meta property="article:published_time" content="2017-11-01T00:00:00&#43;00:00"/>

<meta property="article:modified_time" content="2017-11-01T00:00:00&#43;00:00"/>












<title>


     Let there be light! 

</title>
<link rel="canonical" href="/https:/shyamvalsan.com/https:/shyamvalsan.com/blog/yeelightwifiraspberrypi/">







<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/styles/default.min.css">




<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700|Ubuntu+Mono:400,400i,700,700i|Raleway:500">



    
    <link rel="stylesheet" href="/https:/shyamvalsan.com/css/reset.css?t=2017-11-02%2000%3a17%3a13.483367881%20%2b0530%20IST%20m%3d%2b0.064341482">
    <link rel="stylesheet" href="/https:/shyamvalsan.com/css/pygments.css?t=2017-11-02%2000%3a17%3a13.483367881%20%2b0530%20IST%20m%3d%2b0.064341482">
    <link rel="stylesheet" href="/https:/shyamvalsan.com/css/main.css?t=2017-11-02%2000%3a17%3a13.483367881%20%2b0530%20IST%20m%3d%2b0.064341482">
    
        <link rel="stylesheet" href="/https:/shyamvalsan.com/css/override.css?t=2017-11-02%2000%3a17%3a13.483367881%20%2b0530%20IST%20m%3d%2b0.064341482">
    




<link rel="shortcut icon"

    href="/https:/shyamvalsan.com/img/favicon.ico"

>




</head>


<body lang="en">

<section class="header">
    <div class="container">
        <div class="content">
            
                
                
                
                
                
                    
                
                    
                
                    
                        
                    
                
                    
                        
                    
                
                    
                        
                    
                
                    
                
                
                <a href="/https:/shyamvalsan.com/"><img class="avatar" src="/https:/shyamvalsan.com/img/profile.png" srcset="/https:/shyamvalsan.com/https:/shyamvalsan.com/img/profile.png 1x,/https:/shyamvalsan.com/img/profile-2x.png 2x,/https:/shyamvalsan.com/img/profile-3x.png 3x,/https:/shyamvalsan.com/img/profile-4x.png 4x"></a>
            
            <a href="/https:/shyamvalsan.com/"><div class="name">Shyam Valsan</div></a>
            
            <nav>
                <ul>
                    
                        <li class="nav-about"><a href="/https:/shyamvalsan.com/about/"><span>About</span></a></li>
                    
                        <li class="nav-blog"><a href="/https:/shyamvalsan.com/blog/"><span>Blog</span></a></li>
                    
                        <li class="nav-contact"><a href="/https:/shyamvalsan.com/contact/"><span>Contact</span></a></li>
                    
                </ul>
            </nav>
        </div>
    </div>
</section>

<section class="icons">
    <div class="container">
        <div class="content">

        
            <a href="//github.com/shyamvalsan" target="_blank" rel="noopener"><img class="icon" src="/https:/shyamvalsan.com/img/github.svg" alt="github" /></a>
        

        
            <a href="//twitter.com/shyamvalsan" target="_blank" rel="noopener"><img class="icon" src="/https:/shyamvalsan.com/img/twitter.svg" alt="twitter" /></a>
        

        

        
            <a href="//linkedin.com/in/shyamvalsan" target="_blank" rel="noopener"><img class="icon" src="/https:/shyamvalsan.com/img/linkedin.svg" alt="linkedin" /></a>
        

        
            <a href="//facebook.com/shyamvalsan" target="_blank" rel="noopener"><img class="icon" src="/https:/shyamvalsan.com/img/facebook.svg" alt="facebook" /></a>
        

        
            <a href="//instagram.com/travelverse" target="_blank" rel="noopener"><img class="icon" src="/https:/shyamvalsan.com/img/instagram.svg" alt="instagram" /></a>
        

        

        
            <a href="mailto:shyam.valsan@gmail.com"><img class="icon" src="/https:/shyamvalsan.com/img/email.svg" alt="email" /></a>
        

        
            <a href="/https:/shyamvalsan.com/https:/shyamvalsan.com/index.xml"><img class="icon" src="/https:/shyamvalsan.com/img/rss.svg" alt="rss" /></a>
        
        
        </div>
    </div>
</section>


<section class="main post non-narrow zero-top-spacing">
    <div class="container">
        <div class="content">
            <div class="front-matter">
                <div class="title-container">
                    <div class="page-heading">

    Let there be light!

</div>

                    <div class="initials"><a href="/https:/shyamvalsan.com/https:/shyamvalsan.com">ad</a></div>
                </div>
                <div class="meta">
                    
                    <div class="date" title='Wed Nov 1 2017 00:00:00 UTC'>Nov 1, 2017</div>
                    
                    
		    <div class="reading-time"><div class="middot"></div>4 minutes read</div>
                    
                </div>
            </div>
            <div class="markdown">
                

<p><strong>Yeelight</strong> (now owned by <strong>Xiaomi</strong>) is a company which makes smart bulbs which can be controlled over WiFi or BLE (Bluetooth Low Energy). I got my hands on one of their WiFi smart bulbs as part of some hackathon goodies from work. They have a snappy android app which let&rsquo;s you change colors, brightness and allow the light to flash/flow according to the music you&rsquo;re playing. All very nice and dandy - but in the spirit of tinkerers and DIYers everywhere, that wasn&rsquo;t what I was here for. My goal was to be able to get to the nitty gritty, learn the messaging protocol the bulb uses and control the bulb from wherever I please.</p>

<p>My initial thought was to setup some traffic captures to decode the control messages from the app and then replicate them, but to my surprise I found that Yeelight is very DIY-friendly and they have a developer mode you can enable plus a very thorough <a href="http://www.yeelight.com/download/Yeelight_Inter-Operation_Spec.pdf">operation specification document</a> - this made things very (<em>too?</em>) easy.</p>

<p>The bulb uses SSDP to advertise itself and its capabilities periodically, commands can be sent to the bulb in the format specified in the spec. I found the simplest way to do this is just running <strong>netcat</strong> (nc) with the command contents.</p>

<blockquote>
<p>Why would you want to control the bulb yourself when there&rsquo;s a perfectly fine app?</p>

<p>The primary reason for me, I have to be honest, is the geek-thrill of figuring out how something works. Once you have full control of the bulb you can enable a LOT more use-cases than what the original creators would have thought of.</p>

<p>You could flash a particular color when your phone gets an alert in silent mode.
  Or flash a particular color to remind you to do something, water the plants or feed the pet, or use it as a silent alarm.
  Or turn on the light automatically when the sun goes down OR when you get home from office. Turn it off when everyone&rsquo;s gone to sleep.
  Or code up disco mode and jazz up your party.</p>
</blockquote>

<p>I wrote a simple <a href="https://github.com/shyamvalsan/YeelightController/blob/master/light.sh">shell script</a> (see link to git repo below) that let&rsquo;s you control the smart bulb from Linux (I used a RaspberryPi) along with step by step instructions to use it - my goal with this script is to keep things as simple and short as possible, as a result I have avoided the SSDP discovery procedure as I couldn&rsquo;t find a <em>&ldquo;shell&rdquo;</em> way to do it. Instead I worked around by using arp and netcat to <em>&ldquo;discover&rdquo;</em> the IP address of the bulb.</p>

<p>See the <a href="https://github.com/shyamvalsan/YeelightController">git repo</a> for details but in a nutshell I filter for the manufacturer in the MAC and also check if a particular port is open to verify the IP, hacky but works. Python let&rsquo;s you do the whole thing including the SSDP part, here&rsquo;s a reference from the <a href="https://www.yeelight.com/download/developer/yeelight_demo_lan_ctrl_python.zip">yeelight developer page</a></p>

<h2 id="code">Code</h2>

<p><a href="https://github.com/shyamvalsan/YeelightController">https://github.com/shyamvalsan/YeelightController</a></p>

<h2 id="step-by-step-instructions">Step by step instructions</h2>

<pre><code>1. Plug in the yeelight smart bulb
2. Turn on the light switch
3. Run ./light-configure.sh
4. Wait till light-configure exits, confirm that it ended successfully. If not try repeating steps 2 and 3
5. Run ./light.sh -h for options on how to control the bulb
</code></pre>

<pre><code class="language-shell">light.sh [command] &lt;color&gt; -- utility to control Yeelight smart bulb over wifi

where command can have one of the following values:
    on - turn on the light
    off - turn off the light
    color &lt;color&gt; - set the color to &lt;color&gt; where &lt;color&gt; is a color (red/blue/green/white and so on)
    disco - turns on disco mode
    sunrise - turns on sunrise mode
    notify-blue - notification in blue color
    notify-green - notification in green color
    notify-red - notification in red color
</code></pre>

<h2 id="requirements">Requirements</h2>

<ul>
<li><a href="http://www.ebay.in/itm/Xiaomi-Yeelight-White-Color-LED-Smart-Bulb-8W-WiFi-Control-Adjustable-Brightness-/152609584877?hash=item23883d76ed">Yeelight wifi</a></li>
<li><a href="http://www.ebay.in/itm/B22-to-E27-LED-Halogen-CFL-Light-Base-Bulb-Lamp-Adapter-Converter-Holder-Socket-/132243823330?hash=item1eca589ae2">E27 adapter for Indian bulb sockets</a></li>
<li>RaspberryPi</li>
</ul>

<p><strong>Note:</strong> Since I had only one of these Yeelights with me, the code works for 1 bulb, if you have multiple Yeelights then it&rsquo;s probably a small change to awk out all the matching IPs, assign indexes or identities to them and operate them individually or together. If I ever get my hands on more of these bulbs I&rsquo;ll update the git repo.</p>

                <br>
		<p><a href="/https:/shyamvalsan.com/blog/">Back to posts</a></p>
            </div>
            <br>
            <div class="disqus">
                <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "shyamvalsan" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
            </div>
        </div>
    </div>
</section>



<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-109088908-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>



  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/highlight.min.js"></script>
  

  <script type="text/javascript">
    hljs.initHighlightingOnLoad();
  </script>




</body>
</html>

